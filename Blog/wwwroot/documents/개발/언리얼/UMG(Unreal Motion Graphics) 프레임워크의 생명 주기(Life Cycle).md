---
Title: UMG(Unreal Motion Graphics) 프레임워크의 생명 주기(Life Cycle)
ThumbnailUri:
Tags:
  - Unreal
---

# 개요

언리얼 엔진은 효율적인 UI 제작을 위해 **UMG(Unreal Motion Graphics) 프레임워크**를 제공합니다. UMG의 동작을 완벽하게 제어하고 최적화하기 위해서는 그 내부적인 생명주기를 정확히 이해하는 것이 매우 중요합니다.

# UMG와 Slate의 관계: 래퍼(Wrapper)와 실체

**UMG**는 그 자체로 UI를 화면에 그리지 않습니다. UMG는 **슬레이트(Slate)**를 감싸는 래퍼 클래스입니다.

- **슬레이트 (`SWidget`):** 실제 UI를 렌더링하고 상호작용을 처리하는 C++ 기반의 실체입니다. 모든 시각적 요소와 기능은 슬레이트 위젯에 의해 구현됩니다. `UObject` 시스템의 일부가 아니며, 공유 포인터(`TSharedPtr`)를 통한 참조 카운팅 방식으로 메모리가 관리됩니다.
- **UMG (`UWidget`):** 슬레이트를 `UObject` 시스템으로 가져와 블루프린트와 에디터에서 쉽게 다룰 수 있게 해주는 래퍼입니다. 개발자는 UMG를 통해 슬레이트의 강력한 기능을 편리하게 사용하고, 가비지 컬렉션, 리플렉션, 블루프린트 노출 등의 `UObject` 시스템의 이점을 누릴 수 있습니다.

이러한 이중 구조 때문에 UMG의 생명주기를 이해하기 위해서는 **UMG 객체의 생명주기**와 그 안에 있는 **내부 슬레이트 위젯의 생명주기**를 반드시 구분해서 생각해야 합니다.

# UMG 위젯의 생명주기와 내부 슬레이트 위젯

UMG 위젯은 `UObject`이므로 언리얼의 표준 가비지 컬렉션(Garbage Collection)에 의해 관리됩니다. 하지만 그 내부에 있는 슬레이트 위젯은 참조 카운팅으로 관리되므로, UMG 래퍼와는 다른, 훨씬 즉각적인 생명주기를 가집니다.

## 1. UMG 위젯 객체 생성

- **UMG 상태:** `CreateWidget` 함수가 실행되면 `UUserWidget` 객체가 메모리에 생성됩니다.
- **Slate 상태:** **아직 생성되지 않음.** 이 시점에는 UMG 래퍼 객체만 존재할 뿐, 화면에 그려질 실체인 슬레이트 위젯은 아직 존재하지 않습니다.
- **주요 이벤트:** `UUserWidget::NativeOnInitialized`가 호출됩니다. UMG 위젯이 존재하는 동안 단 한 번만 호출되므로, 델리게이트 바인딩 등 일회성 초기화 로직에 적합합니다.

## 2. 화면에 추가 - 슬레이트 위젯 생성

`UUserWidget` 기반 클래스를 `CreateWidget` 함수로 생성해 `UUserWidget::AddToViewport`를 호출하거나 `UWidget` 기반 클래스를 다른 패널 위젯의 자식으로 추가하는 순간, 내부 슬레이트 위젯의 생성이 시작됩니다.

- **내부 프로세스:** UMG 위젯의 `UWidget::RebuildWidget` 함수가 호출되어, 실제 슬레이트 위젯(`SButton`, `STextBlock` 등)들이 계층 구조를 이루며 생성됩니다.
- **UMG 상태:** 내부 슬레이트 위젯에 대한 강한 참조를 가지게 됩니다.
- **Slate 상태:** **생성 완료.** 부모-자식 관계를 포함한 모든 슬레이트 위젯이 메모리에 생성됩니다. 부모 슬레이트 위젯은 자식 슬레이트 위젯에 대한 강한 참조를 갖게 됩니다.
- **주요 이벤트:** `UUserWidget::NativeConstruct`가 호출됩니다. 이 이벤트는 내부 슬레이트 위젯이 완전히 생성된 후에 호출되므로, 애니메이션을 재생하거나 위젯의 외형을 동적으로 구성하는 등 화면 표시와 관련된 로직을 실행하기에 가장 이상적인 시점입니다. 또한 슬레이트 생성 여부에 따라 여러 번 호출될 수 있습니다.

## 3. 화면에서 제거 - 슬레이트 위젯 파괴

`UWidget::RemoveFromParent`가 호출되면, UMG 위젯의 내부 슬레이트 위젯의 파괴 절차가 시작됩니다. 이 과정의 핵심은 **내부 슬레이트 위젯을 소멸시키기 위해 모든 강한 참조를 끊는 것**입니다.

1.  **부모로부터 분리:** `UWidget::RemoveFromParent`는 부모 `UPanelWidget`의 `RemoveChild` 함수를 호출합니다. 이 함수는 자식 위젯을 감싸고 있던 `UPanelSlot`을 제거하는 것으로부터 시작합니다.
    - 참고: 어떤 `UWidget` 클래스든 실제로 화면에 표시되기 위해서는 패널 위젯에 추가되어야 합니다.
2.  **부모의 참조 해제:** `RemoveChildAt` 내부에서 `OnSlotRemoved`가 호출됩니다. 이 함수는 부모 패널의 **슬레이트 위젯**에게 자식 **슬레이트 위젯**을 제거하라고 명령합니다. 이 순간, 부모가 자식에 대해 가지고 있던 **첫 번째 강한 참조가 해제**됩니다.
3.  **자신의 참조 해제:** 이어서 `PanelSlot->ReleaseSlateResources`가 호출되고, 이는 최종적으로 제거될 자식 UMG 위젯 자신의 `ReleaseSlateResources` 함수를 호출합니다. 이 함수 안에서 UMG 위젯은 스스로 SlateWidget의 `TSharedPtr::Reset()`을 실행하여, 자기 내부의 슬레이트 위젯에 대해 가지고 있던 **두 번째 강한 참조를 해제**합니다.
4.  **즉각적인 파괴:** 슬레이트 위젯을 향한 모든 주요 강한 참조가 해제되면, 참조 카운트가 0이 되어 **가비지 컬렉션을 기다리지 않고 즉시 메모리에서 파괴됩니다.**
5.  **주요 이벤트:** 이 과정의 일부로 `UWidget::NativeDestruct` 이벤트가 호출됩니다. 개발자는 이 시점에서 위젯이 화면에서 사라지기 직전에 필요한 정리 작업을 수행할 수 있습니다. 또한 슬레이트 파괴 여부에 따라 여러 번 호출될 수 있습니다.

## 4. UMG 객체의 파괴

`RemoveFromParent`가 실행되어 내부 슬레이트 위젯이 파괴된 후에도, UMG 래퍼 객체 자체는 아직 메모리에 남아있을 수 있습니다. 이 `UObject`는 다른 블루프린트 변수 등에 의해 참조되고 있지 않을 때, 언리얼 엔진의 다음 가비지 컬렉션 주기에 수집되어 최종적으로 메모리에서 제거됩니다.
